# Dokumentasi Backend & Database System

Dokumentasi ini mencakup detail teknis mengenai arsitektur backend, skema database, dan logika bisnis utama pada aplikasi Inventaris MSU.

## 1. Technology Stack

*   **Framework**: Laravel 11.x
*   **Language**: PHP 8.2+
*   **Database**: MySQL / SQLite (Configurable via `.env`)
*   **Frontend Stack**: Blade Templates + Livewire 3
*   **Styling**: Bootstrap 5 + Custom CSS
*   **Authentication**: Laravel Fortify

---

## 2. Database Schema & Models

Aplikasi ini menggunakan beberapa tabel utama untuk mengelola inventaris dan peminjaman.

### A. Core Tables

1.  **`users`** (Model: `User`)
    *   Menyimpan data akun untuk **Pengelola** dan **Pengurus**.
    *   **Kolom Penting**: `email`, `password`, `role` ('pengelola' | 'pengurus').
    *   *Note*: Guest tidak masuk ke tabel ini karena tidak memiliki akun login.

2.  **`inventories`** (Model: `Inventory`)
    *   Menyimpan data Barang dan Ruangan.
    *   **Kolom Penting**:
        *   `nama_barang`: Nama item.
        *   `kode_barang`: Kode unik aset.
        *   `kategori`: 'Barang' atau 'Ruangan'.
        *   `stok_total`: Jumlah total aset.
        *   `stok_tersedia`: Jumlah yang bisa dipinjam saat ini.
        *   `is_active`: Status aktif/non-aktif item.

3.  **`loan_requests`** (Model: `LoanRequest`)
    *   Header transaksi peminjaman ( satu request bisa berisi banyak item).
    *   **Kolom Penting**:
        *   `no_peminjaman`: ID unik transaksi (misal: INV-202412...).
        *   `peminjam_nama`, `peminjam_prodi`, `peminjam_no_induk`: Identitas Guest.
        *   `tgl_pinjam`, `tgl_kembali`: Rentang waktu peminjaman.
        *   `status`: 'Menunggu Approve', 'Siap Diambil', 'Sedang Dipinjam', 'Selesai', 'Ditolak', 'Terlambat'.
        *   `file_proposal`: Path ke file proposal (jika ada).

4.  **`loan_items`** (Model: `LoanItem`)
    *   Detail item dalam satu transaksi peminjaman.
    *   **Relasi**: `BelongsTo` LoanRequest, `BelongsTo` Inventory.
    *   **Kolom Penting**: `jumlah` (qty dipinjam), `kondisi_keluar`, `kondisi_masuk`.

5.  **`loan_records`** (Model: `LoanRecord`)
    *   Log historis untuk **Pengurus** saat barang keluar/masuk.
    *   Mencatat siapa yang memproses (serah terima) barang.

---

## 3. Backend Architecture (MVC + Livewire)

Aplikasi ini menggunakan pendekatan Hybrid: Controller standar untuk API/Export, dan Livewire Components untuk UI interaktif.

### A. Livewire Modules

Logika bisnis utama terbagi dalam 3 namespace:

#### 1. Namespace `App\Livewire\Guest`
Modul untuk pengguna umum (Mahasiswa).
*   **`Home`**: Landing page & Search awal.
*   **`Catalogue`**: Filter barang, search, tambah ke keranjang.
*   **`Cart`**:
    *   Mengelola Logic Keranjang Belanja (Session Based).
    *   Validasi stok sebelum checkout.
    *   Menyimpan data ke `loan_requests` saat checkout berhasil.
    *   *Trait*: Menggunakan `HandlesCart` untuk logika sesi keranjang.

#### 2. Namespace `App\Livewire\Pengelola` (Admin)
Modul untuk administrator utama.
*   **`Beranda`**: Dashboard statistik.
*   **`Approval`**: Logika validasi request. Mengubah status dari `Menunggu Approve` -> `Siap Diambil` atau `Ditolak`.
*   **`TambahHapus`**: CRUD Inventory.
*   **`Laporan`**: Menampilkan data historis dengan Pagination custom dan Chart interaktif.

#### 3. Namespace `App\Livewire\Pengurus` (Operasional)
Modul untuk petugas lapangan.
*   **`Dashboard`**: Monitoring barang yang harus disiapkan hari ini.
*   **`PeminjamanFasilitas`**: Proses serah terima. Mengubah status `Siap Diambil` -> `Sedang Dipinjam` -> `Selesai`.

### B. API & Controllers

Beberapa fitur spesifik menggunakan Controller standar Laravel:

*   **`App\Http\Controllers\Api\CartController`**:
    *   Menangani manipulasi keranjang via AJAX (jika ada interaksi JS murni).
    *   Methods: `add`, `update`, `clear`.
*   **`App\Http\Controllers\Pengelola\LaporanExportController`**:
    *   Menangani download laporan dalam format Excel (.xlsx), CSV, dan PDF.

---

## 4. Key Implementation Details

### Session-Based Cart
Keranjang peminjaman Guest tidak disimpan di database (`cart` table), melainkan di **Session Browser**.
*   Data struktur: `['id_barang' => ['qty' => 2, 'details' => ...]]`.
*   Saat checkout, baru dipindahkan ke tabel `loan_requests` dan `loan_items`.

### Authentication
*   Menggunakan **Laravel Fortify**.
*   Config: `config/fortify.php`.
*   View Login: `resources/views/livewire/auth/login.blade.php`.
*   Middleware `auth` melindungi route `/pengelola` dan `/pengurus`.

### Pagination & Filtering
*   Halaman Laporan menggunakan **Server-Side Pagination** untuk performa.
*   Filtering (Date, Category, Status) dilakukan di query database (`Laporan.php`), bukan filtering JS di client-side, untuk memastikan akurasi data.
